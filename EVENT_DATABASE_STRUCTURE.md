# Event Database Structure - Iranian Community Admin Panel

## Overview
This document defines the complete database structure for events in the Iranian Community Admin Panel. The structure is designed for Firebase Firestore but can be adapted to other NoSQL or SQL databases.

## Collection: `events`

### Document Structure

```javascript
{
  // Document ID (auto-generated by Firestore)
  id: "string", // Auto-generated document ID
  
  // Basic Event Information
  title: "string", // Required - Event title
  description: "string", // Required - Detailed event description
  organizer: "string", // Required - Name of event organizer
  category: "string", // Required - Event category (see categories below)
  
  // Date and Time
  eventDate: "timestamp", // Required - Event start date (Firestore Timestamp or ISO string)
  endDate: "timestamp", // Optional - Event end date (Firestore Timestamp or ISO string)
  eventTime: "string", // Required - Start time in HH:MM format (24-hour)
  endTime: "string", // Optional - End time in HH:MM format (24-hour)
  
  // Location Information
  location: {
    isOnline: "boolean", // Required - Whether event is online
    venue: "string", // Required for in-person events - Venue name
    address: "string", // Required for in-person events - Street address
    city: "string", // Required for in-person events - City name
    province: "string", // Required for in-person events - Province/State
    onlineLink: "string" // Required for online events - Meeting/streaming URL
  },
  
  // Pricing and Capacity
  ticketPrice: "number", // Optional - Ticket price (0 for free events)
  maxAttendees: "number", // Optional - Maximum attendees (null for unlimited)
  attendees: "number", // Current number of registered attendees (default: 0)
  
  // Contact Information
  contactEmail: "string", // Required - Contact email for inquiries
  contactPhone: "string", // Optional - Contact phone number
  registrationUrl: "string", // Optional - External registration URL
  
  // Status and Settings
  status: "string", // Required - Event status (see statuses below)
  featured: "boolean", // Whether event is featured (default: false)
  
  // Metadata
  userId: "string", // ID of user who created the event
  createdAt: "timestamp", // Firestore server timestamp
  updatedAt: "timestamp" // Firestore server timestamp
}
```

## Field Specifications

### Required Fields
- `title` (string, min 3 characters)
- `description` (string, min 10 characters)
- `organizer` (string)
- `category` (string, must be from predefined categories)
- `eventDate` (timestamp, cannot be in the past)
- `eventTime` (string, HH:MM format)
- `contactEmail` (string, valid email format)
- `status` (string, must be from predefined statuses)

### Optional Fields
- `endDate` (timestamp, must be after eventDate if provided)
- `endTime` (string, HH:MM format)
- `ticketPrice` (number, >= 0)
- `maxAttendees` (number, > 0 or null for unlimited)
- `contactPhone` (string)
- `registrationUrl` (string, valid URL)
- `featured` (boolean, default: false)

### Location Rules
- If `location.isOnline` is `true`:
  - `location.onlineLink` is required
  - Physical location fields are optional
- If `location.isOnline` is `false`:
  - `location.venue`, `location.address`, `location.city`, `location.province` are required
  - `location.onlineLink` is optional

## Predefined Values

### Event Categories
```javascript
const EVENT_CATEGORIES = [
  "Cultural",
  "Educational",
  "Social",
  "Religious",
  "Business",
  "Sports",
  "Arts",
  "Music",
  "Food",
  "Community Service",
  "Other"
];
```

### Event Statuses
```javascript
const EVENT_STATUSES = [
  "draft",      // Event is being created/edited
  "pending",    // Waiting for admin approval
  "approved",   // Approved and visible to public
  "rejected",   // Rejected by admin
  "cancelled"   // Event has been cancelled
];
```

### Cities (Canadian Focus)
```javascript
const CITIES = [
  "Toronto",
  "Vancouver",
  "Montreal",
  "Calgary",
  "Ottawa",
  "Edmonton",
  "Mississauga",
  "Winnipeg",
  "Quebec City",
  "Hamilton",
  "Other"
];
```

### Provinces (Canada)
```javascript
const PROVINCES = [
  "Alberta",
  "British Columbia",
  "Manitoba",
  "New Brunswick",
  "Newfoundland and Labrador",
  "Northwest Territories",
  "Nova Scotia",
  "Nunavut",
  "Ontario",
  "Prince Edward Island",
  "Quebec",
  "Saskatchewan",
  "Yukon"
];
```

## Data Types and Formats

### Timestamps
- **Storage**: Firestore Timestamp objects
- **API**: ISO 8601 strings (YYYY-MM-DDTHH:mm:ss.sssZ)
- **Form Input**: Date strings (YYYY-MM-DD) and time strings (HH:MM)

### Numbers
- **ticketPrice**: Float/Decimal (e.g., 25.99)
- **maxAttendees**: Integer or null
- **attendees**: Integer (default: 0)

### Strings
- **eventTime/endTime**: 24-hour format (e.g., "14:30", "09:00")
- **contactEmail**: Valid email format
- **registrationUrl/onlineLink**: Valid URL format

## Example Documents

### In-Person Event Example
```javascript
{
  id: "event_123",
  title: "Persian New Year Celebration",
  description: "Join us for a traditional Nowruz celebration with music, food, and cultural activities.",
  organizer: "Iranian Cultural Association",
  category: "Cultural",
  eventDate: "2024-03-20T00:00:00.000Z",
  endDate: null,
  eventTime: "18:00",
  endTime: "22:00",
  location: {
    isOnline: false,
    venue: "Community Center Hall",
    address: "123 Main Street",
    city: "Toronto",
    province: "Ontario",
    onlineLink: ""
  },
  ticketPrice: 25.00,
  maxAttendees: 200,
  attendees: 45,
  contactEmail: "events@iranianculture.ca",
  contactPhone: "+1-416-555-0123",
  registrationUrl: "https://eventbrite.com/nowruz2024",
  status: "approved",
  featured: true,
  userId: "user_456",
  createdAt: "2024-02-15T10:30:00.000Z",
  updatedAt: "2024-02-20T14:15:00.000Z"
}
```

### Online Event Example
```javascript
{
  id: "event_789",
  title: "Persian Language Learning Workshop",
  description: "Interactive online workshop for beginners to learn basic Persian phrases and grammar.",
  organizer: "Dr. Sarah Ahmadi",
  category: "Educational",
  eventDate: "2024-04-15T00:00:00.000Z",
  endDate: null,
  eventTime: "19:00",
  endTime: "21:00",
  location: {
    isOnline: true,
    venue: "",
    address: "",
    city: "",
    province: "",
    onlineLink: "https://zoom.us/j/123456789"
  },
  ticketPrice: 0,
  maxAttendees: null, // Unlimited
  attendees: 28,
  contactEmail: "sarah.ahmadi@email.com",
  contactPhone: "",
  registrationUrl: "",
  status: "approved",
  featured: false,
  userId: "user_789",
  createdAt: "2024-03-01T09:00:00.000Z",
  updatedAt: "2024-03-01T09:00:00.000Z"
}
```

## Validation Rules Summary

1. **Date Validation**: eventDate cannot be in the past
2. **End Date**: If provided, must be after eventDate
3. **Capacity**: maxAttendees must be positive integer or null (unlimited)
4. **Price**: ticketPrice must be >= 0
5. **Email**: contactEmail must be valid email format
6. **URLs**: registrationUrl and onlineLink must be valid URLs
7. **Location**: Conditional validation based on isOnline flag
8. **Categories**: Must be from predefined list
9. **Status**: Must be from predefined list

## Indexes Recommended

For optimal query performance, create these Firestore indexes:

```javascript
// Composite indexes
events: [
  ["status", "eventDate"],
  ["category", "eventDate"],
  ["featured", "eventDate"],
  ["userId", "createdAt"],
  ["status", "featured", "eventDate"]
]

// Single field indexes (auto-created)
- eventDate
- status  
- category
- featured
- userId
- createdAt
```

## Security Rules (Firestore)

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /events/{eventId} {
      // Allow read for approved events
      allow read: if resource.data.status == 'approved';
      
      // Allow admin users to read all events
      allow read: if request.auth != null && 
                     get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      
      // Allow users to create events (will be pending)
      allow create: if request.auth != null && 
                       request.resource.data.userId == request.auth.uid &&
                       request.resource.data.status == 'pending';
      
      // Allow users to update their own events (if not approved yet)
      allow update: if request.auth != null && 
                       resource.data.userId == request.auth.uid &&
                       resource.data.status in ['draft', 'pending'];
      
      // Allow admin to update any event
      allow update: if request.auth != null && 
                       get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      
      // Allow admin to delete events
      allow delete: if request.auth != null && 
                       get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}
```

---

**Note**: This structure is designed for the Iranian Community Admin Panel and can be adapted for other community management systems. The structure supports both online and in-person events with flexible capacity management and comprehensive metadata tracking.
